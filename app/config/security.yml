security:
  encoders:
    FOS\UserBundle\Model\UserInterface: sha512

  role_hierarchy:
    ROLE_ADMIN:       [ROLE_USER, ROLE_SONATA_ADMIN]
    ROLE_SUPER_ADMIN: [ROLE_ADMIN, ROLE_ALLOWED_TO_SWITCH]
    SONATA:
      - ROLE_SONATA_PAGE_ADMIN_PAGE_EDIT

  providers:
    fos_userbundle:
      id: fos_user.user_manager
    ldap:
      id: imag_ldap.security.user.provider
    multiples:
      chain:
        providers: [fos_userbundle, ldap]

  firewalls:
    dev:
      pattern:  ^/(_(profiler|wdt)|css|images|js)/
      security: false

    api_screen_activate:
      pattern: ^/api/screen/activate
      security: false

    api_screen_get:
      pattern: ^/api/screen/get
      security: false

    zencoder:
      pattern: ^/zencoder/callback
      security: false

    main:
      pattern: ^/
      anonymous: ~
      imag_ldap:
        provider: ldap
      logout:
        path:           /logout
        target:         /
      remember_me:
        key:      "%secret%"
        lifetime: 604800 # a week
        path:     /
        domain:   ~
        user_provider: fos_userbundle

  access_control:
    - { path: ^/api/screen/activate$, role: IS_AUTHENTICATED_ANONYMOUSLY, ip: 127.0.0.1}
    - { path: ^/api/screen/get$, role: IS_AUTHENTICATED_ANONYMOUSLY, ip: 127.0.0.1}

    # Zencoder.
    - { path: ^zencoder/callback, role: IS_AUTHENTICATED_ANONYMOUSLY }

    # URL of FOSUserBundle which need to be available to anonymous users
    - { path: ^/login$, role: IS_AUTHENTICATED_ANONYMOUSLY }
    - { path: ^/register, role: IS_AUTHENTICATED_ANONYMOUSLY }
    - { path: ^/resetting, role: IS_AUTHENTICATED_ANONYMOUSLY }

    # Admin login page needs to be access without credential
    - { path: ^/admin/login$, role: IS_AUTHENTICATED_ANONYMOUSLY }
    - { path: ^/admin/logout$, role: IS_AUTHENTICATED_ANONYMOUSLY }
    - { path: ^/admin/login_check$, role: IS_AUTHENTICATED_ANONYMOUSLY }

    # Secured part of the site
    - { path: ^/admin/, role: [ROLE_ADMIN, ROLE_SONATA_ADMIN] }
    - { path: ^/, role: [ROLE_USER, ROLE_LDAP] }

  acl:
    connection: default

imag_ldap:
  client:
    host: %ad_ldap_host%
    port: 389
    username: %ad_username%
    password: %ad_password%
  user:
    base_dn: %ad_ldap_base_dn%
    filter: (&(objectClass=user)(memberof=%ad_group%))
    name_attribute: cn
  role:
    base_dn: %ad_ldap_base_dn%
    name_attribute: cn
    user_id: username
  user_class: Indholdskanalen\MainBundle\User\LdapUser